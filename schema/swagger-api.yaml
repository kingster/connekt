swagger: '2.0'
info:
  title: Connekt API
  description: Fast Forward Communications with the Connekt API
  version: 1.0.0
host: 10.84.178.131:28000
schemes:
  - http
basePath: /v1
tags:
- name: "Registration"
  description: "manage device registrations"
- name: "Send"
  description: "trigger communications"
- name: "Callback"
  description: "manage events corresponding to send requests"
- name: "Report"
  description: "query events corresponding to send requests"
- name: "Admin"
  description: "manage platform clients and privileges"
- name: "Fetch"
  description: "pull based messaging operations"
- name: "Debug"
  description: "Debugger"
- name: "Stencil"
  description: "Stencil"
produces:
  - application/json
parameters:
  api-key:
    name: x-api-key
    in: header
    description: API key
    required: true
    type: string
    format: string
    default: "sandbox-key-01"
  secure-code:
    name: x-secure-code
    in: header
    description: Secure Code
    required: true
    type: string
    format: string
  MPlatform:
    name: MPlatform
    in: path
    description: OS Platfrom
    required: true
    type: string
    enum:
      - android
      - ios
      - windows
      - openweb
      - unknown
    format: string
  appName:
    name: appName
    in: path
    description: AppName.
    required: true
    type: string
    format: string
  deviceId:
    name: deviceId
    in: path
    description: DeviceId.
    required: true
    type: string
    format: string
  userId:
    name: userId
    in: path
    description: userId.
    required: true
    type: string
    format: string
  messageId:
    name: messageId
    in: path
    description: MessageId.
    required: true
    type: string
    format: string
  clientName:
    name: clientName
    in: path
    description: clientName.
    required: true
    type: string
    format: string
  userType:
    name: userType
    in: path
    description: userType
    required: true
    type: string
    enum:
      - USER
      - GLOBAL
      - GROUP
    format: string
  stencilName:
    name: stencilName
    in: path
    description: StencilName.
    required: true
    type: string
    format: string
  stencilVersion:
    name: stencilVersion
    in: path
    description: stencilVersion.
    required: true
    type: string
    format: string
  bucketName:
    name: bucketName
    in: path
    description: bucketName.
    required: true
    type: string
    format: string
paths:
  /registration/push/{MPlatform}/{appName}/{deviceId}:
    put:
      tags:
        - "Registration"
      summary: Register New Device
      description: |
        Registrion of a new device. The token from this registration data would be used sending pn..
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/secure-code'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
        - name: deviceData
          in: body
          description: deviceData Defination.
          required: true
          schema:
            $ref: '#/definitions/DeviceDetails'
      responses:
        '201':
          description:  Device details created
        '200':
          description: Device details update
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: Get Device Details
      description: |
       Fetch device details for specific device
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
      tags:
        - Registration
      responses:
        '200':
          description: Device details
    delete:
      summary: Delete Device
      description: |
       Delete specific device
      tags:
        - Registration
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/secure-code'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
      responses:
        '200':
          description: Device deleted succesfully
  /registration/push/{appName}/users/{userId}:
    get:
      tags:
      - "Registration"
      operationId: "getRegistrationForUserId"
      summary: "fetch user device(s) registration"
      description: "fetch registration info for user's devices"
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/userId'
      responses:
        200:
          description: "device(s) details fetched for user"
        404:
          description: "no device details found for user"
  /send/push/{MPlatform}/{appName}:
    post:
      summary: Send Push Notification
      description: |
        Send a new push notification to a given set of devices.
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - name: ConnektRequest
          in: body
          description: ConnektRequest.
          required: true
          schema:
            $ref: '#/definitions/ConnektRequest'
      tags:
        - "Send"
      responses:
        '201':
          description:  PN Created
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /send/push/{MPlatform}/{appName}/users/{userId}:
    post:
      summary: Send Push Notification to User
      description: |
        Send a new push notification all devices of given user and platform.
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/userId'
        - name: ConnektRequest
          in: body
          description: ConnektRequest.
          required: true
          schema:
            $ref: '#/definitions/ConnektRequest'
      tags:
        - "Send"
      responses:
        '201':
          description:  PN Created
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /push/callback/{MPlatform}/{appName}/{deviceId}:
    post:
      summary: Notification Callback
      description: |
        Callback's for notifications
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/secure-code'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
        - name: callbackEvent
          in: body
          description: CallbackEvent.
          required: true
          schema:
            type: object
      tags:
        - "Callback"
      responses:
        '200':
          description:  Callback Accepted
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /push/callback/{MPlatform}/{appName}/{deviceId}/{messageId}:
    delete:
      tags:
      - "Callback"
      operationId: "deleteCallbackEvents"
      summary: "delete callback events of a connekt request"
      description: "delete callback events of a connekt request"
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
        - $ref: '#/parameters/messageId'
      responses:
        200:
          description: "callback events deleted for messageId."
  /fetch/push/{MPlatform}/{appName}/{deviceId}:
    get:
      summary: Fetch Notifications
      description: |
        Fetch Pending Notifications for given device
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/MPlatform'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
        - name: startTs
          in: query
          description: StartTS.
          required: true
          type: number
          format: long
        - name: endTs
          in: query
          description: EndTS.
          required: false
          type: number
          format: long
        - name: skipIds
          in: query
          description: Skip Specific MessageIds
          required: false
          type: string
      tags:
        - "Fetch"
      responses:
        '200':
          description:  List of PN
        '400':
          description:  Invalid StartTS
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /reports/push/{appName}/messages/{deviceId}:
    get:
      summary: Fetch Notifications by device ID
      description: |
        Fetch messages sent for given device ID
      parameters:
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
        - name: startTs
          in: query
          description: StartTS.
          required: false
          type: number
          format: long
      tags:
        - "Report"
      responses:
        '200':
          description:  List of PN
        '400':
          description:  Invalid StartTS
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /reports/push/{appName}/messages/{deviceId}/{messageId}/events:
    get:
      summary: MessageId/DeviceId Events
      description: |
        Callback's for notifications
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/appName'
        - $ref: '#/parameters/deviceId'
        - $ref: '#/parameters/messageId'
      tags:
        - "Report"
      responses:
        '200':
          description:  Events
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /reports/push/messages/{messageId}/events:
    get:
      summary: Message Events
      description: |
        Event's for given MessageId
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/messageId'
      tags:
        - "Report"
      responses:
        '200':
          description:  Events
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /reports/push/messages/{messageId}:
    get:
      summary: PN Request Data
      description: |
        Get Request Payload
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/messageId'
      tags:
        - "Report"
      responses:
        '200':
          description:  Original Request
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /reports/date/{date}:
    get:
      summary: Per Date Statistics
      description: |
        Get live statistics grouped per day
      parameters:
        - $ref: '#/parameters/api-key'
        - name: date
          in: path
          description: date.
          required: true
          type: string
        - name: clientId
          in: query
          description: clientId.
          required: true
          type: string
        - name: contextId
          in: query
          description: contextId.
          required: false
          type: string
        - name: appName
          in: query
          description: appName.
          required: false
          type: string
        - name: stencilId
          in: query
          description: stencilId.
          required: false
          type: string
      tags:
        - "Report"
      responses:
        '200':
          description:  Original Request
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /client/{clientName}:
    get:
      tags:
      - "Admin"
      operationId: "getClientInfo"
      summary: "fetch api-key for clientName"
      description: "fetch api-key for clientName"
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/clientName'
      responses:
        200:
          description: "client api-key fetched for clientName"
        404:
          description: "no api-key found for clientName"
  /client/{clientName}/config:
    get:
      tags:
      - "Admin"
      operationId: "getClientConfiguration"
      summary: "fetch configuration for clientName"
      description: "fetch configuration for clientName"
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/clientName'
      responses:
        200:
          description: "client config fetched for clientName"
  /client/create:
    post:
      tags:
      - "Admin"
      operationId: "createClient"
      summary: "create client & assign api-key, groups."
      description: "create client & assign api-key, groups."
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - name: AppUser
          in: body
          description: AppUser.
          required: true
          schema:
            $ref: '#/definitions/AppUser'
      responses:
        200:
          description: "client created and assigned group, api-key."
  /client/create/{clientName}/configuration:
    post:
      tags:
      - "Admin"
      operationId: "configureClientSla"
      summary: "create client & assign api-key, groups."
      description: "create client & assign api-key, groups."
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/clientName'
        - name: appUserConfig
          in: body
          description: appUserConfig.
          required: true
          schema:
            $ref: '#/definitions/AppUserConfiguration'
      responses:
        200:
          description: "client created and assigned group, api-key."
  /grant/{userType}/{userId}:
    post:
      tags:
      - "Admin"
      operationId: "grantResourceAccess"
      summary: "provide user and group resource access to clients."
      description: "provide user and group resource access to clients."
      produces:
      - "application/json"
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/userType'
        - $ref: '#/parameters/userId'
        - name:  grantResourceAccess
          in: body
          description: grantResourceAccess
          required: true
          schema:
            $ref: '#/definitions/ResourcePriv'
      responses:
        201:
          description: "granted access to requested resources"
        404:
          description: "no api-key found for clientName"
        400:
          description: "while user does not existed for user level access"

  /revoke/{userType}/{userId}:
   post:
    tags:
      - "Admin"
    operationId: "revokeResourceAccess"
    summary: "revoke user and group resource access to clients."
    description: "revoke user and group resource access to clients."
    produces:
      - "application/json"
    parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/userType'
        - $ref: '#/parameters/userId'
        - name:  revokeResourceAccess
          in: body
          description: revokeResourceAccess
          required: true
          schema:
            $ref: '#/definitions/ResourcePriv'
    responses:
        201:
          description: "revoked access to requested resources"
        404:
          description: "no api-key found for clientName"
        400:
          description: "while user does not existed for user level access"
  /debugger/secure-code/generate:
    get:
      summary: Generate Secure Code
      description: |
        Generate Secure Code for given set of keys
      parameters:
        - $ref: '#/parameters/api-key'
        - name: keys
          in: query
          description: Comma Separated Keys for Token Generation.
          required: true
          type: string
      tags:
        - "Debug"
      responses:
        '200':
          description:  Secure Code
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /stencil/bucket/{bucketName}:
    post:
      summary: creating bucket
      description: |
        creating bucket for user
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/bucketName'
        - name: createStencilBucket
          in: body
          description: createStencilBucket.
          required: true
          schema:
            type: object
      tags:
        - "Stencil"
      responses:
        '200':
          description:  bucket Create
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
    get:
      summary: get bucket data
      description: |
        get bucket data
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/bucketName'
      tags:
        - "Stencil"
      responses:
        '200':
          description:  Original Request
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /stencil:
    post:
      summary: creating stencil
      description: |
        creating stencil
      parameters:
        - $ref: '#/parameters/api-key'
        - name: createStencil
          in: body
          description: createStencil.
          required: true
          schema:
            $ref: '#/definitions/Stencil'
      tags:
        - "Stencil"
      responses:
        '200':
          description:  stencil Create
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /stencil/{stencilName}:
    get:
      summary: get stencil data
      description: |
        get stencil data
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/stencilName'
      tags:
        - "Stencil"
      responses:
        '200':
          description:  Original Request
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
    post:
      summary: updating stencil
      description: |
        updating stencil
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/stencilName'
        - name: updateStencil
          in: body
          description: updateStencil.
          required: true
          schema:
            $ref: '#/definitions/Stencil'
      tags:
        - "Stencil"
      responses:
        '200':
          description:  stencil Create
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /stencil/{stencilName}/preview:
    post:
      summary: previewing stencil
      description: |
        previewing stencil
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/stencilName'
        - name: previewStencil
          in: body
          description: previewStencil.
          required: true
          schema:
            type: object
      tags:
        - "Stencil"
      responses:
        '200':
          description:  stencil preview
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /stencil/{stencilName}/{stencilVersion}/preview:
    post:
      summary: previewing stencil
      description: |
        previewing stencil for particular version
      parameters:
        - $ref: '#/parameters/api-key'
        - $ref: '#/parameters/stencilName'
        - $ref: '#/parameters/stencilVersion'
        - name: previewStencil
          in: body
          description: previewStencil.
          required: true
          schema:
            type: object
      tags:
        - "Stencil"
      responses:
        '200':
          description:  stencil preview
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'


definitions:
  DeviceDetails:
    type: object
    properties:
      state:
        type: string
        description: An app specific state when this request was triggered.
      model:
        type: string
        description: model of Device
      token:
        type: string
        description: Token.
      brand:
        type: string
        description: brand of Device
      appVersion:
        type: string
        description: appVersion of Device
      osVersion:
        type: string
        description: osVersion of Device.
      userId:
        type: string
        description: UserId
  ConnektRequest:
    type: object
    properties:
      channel:
        type: string
        description: Channel (PN/EMAIL/SMS)
        default: "PN"
        enum:
          - PN
          - EMAIL
      sla:
        type: string
        description: SLA (L/M/H)
        default: "L"
        enum:
          - L
          - M
          - H
      stencilId:
        type: string
        description: Optional StencilId
      contextId:
        type: string
        description: Optional contextId for tracking
      expiryTs:
        type: number
        format: long
        description: Expiry Epoch Time in Millis
      scheduleTs:
        type: number
        format: long
        description: ScheduledTS (Not Available, Currently Ignored)
      channelInfo:
        type: object
        description:  PN Channel Info
        properties:
          deviceIds:
            type: array
            items:
              type: string
            description: List of Destination DeviceIds
          ackRequired:
            type: boolean
            description : ackRequired
            default : false
          delayWhileIdle:
            type: boolean
            description : delayWhileIdle
            default : true
      channelData:
        type: object
        description:  Channel Payload, incase channelDataModel is not provided.
      channelDataModel:
        type: object
        description:  Data Model to be rendered incase stencilId is provided

  Error:
    type: object
    properties:
      status:
        type: integer
        format: int32
      request:
        type: object
      response:
        type: object
        properties:
          message:
            type: string
            description: Error Message
  AppUser:
    type: object
    properties:
      userId:
        type: string
        description: userId / clientName of app user
      groups:
        type: string
        description: comma separated list of groups
      contact:
        type: string
        description: reference email-id for app user
  AppUserConfiguration:
    type: object
    properties:
      channel:
        type: string
        enum:
        - push
        - email
        - sms
        description: channel to configure sla
      maxRate:
        type: integer
        format: int32
        description: max-rate for channel

  ResourcePriv:
    type: object
    properties:
      resources:
        type: string
        description: resource list
  Stencil:
    type: object
    properties:
      id:
        type: string
        description: stencil id
      engine:
        type: string
        enum:
        - GROOVY
        - VELOCITY
        description: engine GROOVY/VELOCITY
      engineFabric:
        type: string
        description: VELOCITY/GROOVY script


